<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, user-scalable=no"/>
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<link rel="apple-touch-icon" href="images/touch-icon-iphone.png">
	<link rel="apple-touch-icon" sizes="76x76" href="images/touch-icon-ipad.png">
	<link href="images/startupiphone.png"
		media="(device-width: 320px)
		and (device-height: 480px)
		and (-webkit-device-pixel-ratio: 2)"
		rel="apple-touch-startup-image">
	<link media="only screen and (max-device-width: 480px)" rel="stylesheet" href="iPhone.css"/>
	<link media="only screen and (min-device-width: 481px)" rel="stylesheet" href="iPad.css"/>
	
	<title>Robot Alpha v4</title>

</head>

<body>
	<div>
	<center>
	<div class="window">
	<img class="webcam"  src="http://192.168.1.4:8080/?action=stream"></img>
	</div>
	</center>
	</div>

	<div class="power">
	<a><center>POWER</center></a>
	<button class="onoff" onclick="onoff(this)"><div>OFF</div></button>
	</div>

	<div class="auto">
	<a><center>MAN/AUTO</center></a>
	<button class="onoff" onclick="onoffauto(this)"><div>MAN</div></button>
	</div>

	<div class="led">
	<a><center>LED</center></a>
	<button class="onoff" onclick="onoffled(this)"><div>OFF</div></button>
	</div>
	
	<div>
	<center>
	<div class="logo">
	<img width="50" height="50" src="images/arduino.png"/>
	<img width="40" height="50" src="images/Raspi.png"/>
	</div>
	</center>
	</div>
	<div id="joystick1" class="joystickdirc"></div>
	<div id="cam" class="cam"></div>
	<span id="joystick1DebugX"></span>
	<span id="joystick1DebugY"></span>
	<span id="camDebugX"></span>
	<span id="camDebugY"></span>
</body> 


  <!-- Scripts loaded here -->
  <script type="text/javascript" src="jquery-1.10.2.min.js"></script>
  <script type="text/javascript" src="kinetic-v4.6.0.min.js"></script>
  <script type="text/javascript" src="jsJoystick.js"></script>

  <script type="text/javascript">

	var xhr;
	xhr = new XMLHttpRequest();
	var buttonstate=0;
	var buttonstateled=0;
	var buttonstateauto=0;

	function onoff(e)
	{
		buttonstate= 1 - buttonstate;
		var blabel, bstyle, bcolor;
		if(buttonstate)
		{
			blabel="ON";
			bstyle="white";
			bcolor="#028E9B";
			var url ='motor.php?state=1';
			xhr.open('GET', url, false);
			xhr.send();
		}
		else
		{
			blabel="OFF";
			bstyle="#028E9B";
			bcolor="white";
			var url ='motor.php?state=0';
			xhr.open('GET', url, false);
			xhr.send();
		}
		var child=e.firstChild;
		child.style.background= bstyle;
		child.style.color= bcolor;
		child.innerHTML= blabel;
	}
	
	function onoffled(e)
	{
		buttonstateled= 1 - buttonstateled;
		var blabel, bstyle, bcolor;
		if(buttonstateled)
		{
			blabel="ON";
			bstyle="white";
			bcolor="#028E9B";
			var url ='motor.php?state=4';
			xhr.open('GET', url, false);
			xhr.send();
		}
		else
		{
			blabel="OFF";
			bstyle="#028E9B";
			bcolor="white";
			var url ='motor.php?state=5';
			xhr.open('GET', url, false);
			xhr.send();
		}
		var child=e.firstChild;
		child.style.background= bstyle;
		child.style.color= bcolor;
		child.innerHTML= blabel;
	}
	
	function onoffauto(e)
	{
		buttonstateauto= 1 - buttonstateauto;
		var blabel, bstyle, bcolor;
		if(buttonstateauto)
		{
			blabel="AUTO";
			bstyle="white";
			bcolor="#028E9B";
			var url ='motor.php?state=3';
			xhr.open('GET', url, false);
			xhr.send();
		}
		else
		{
			blabel="MAN";
			bstyle="#028E9B";
			bcolor="white";
			var url ='motor.php?state=2';
			xhr.open('GET', url, false);
			xhr.send();
		}
		var child=e.firstChild;
		child.style.background= bstyle;
		child.style.color= bcolor;
		child.innerHTML= blabel;
	}
      
	$('#joystick1').jsJoystick({
		callBackFunc: function(evt){
			debugJoystick('joystick1',evt);
		}
    	});
	$('#cam').jsJoystick({
		dragMode: "vertical",
		callBackFunc: function(evt){
			debugJoystick('cam',evt);
		}
    	});
	
	var debugJoystick = function(selectorID,evt) {
      		$('#'+selectorID+'DebugX').html(evt.deltaX + "("+evt.deltaXPercent+" %)" +selectorID); 
      		$('#'+selectorID+'DebugY').html(evt.deltaY + "("+evt.deltaYPercent+" %)" +selectorID); 
		if (selectorID == 'joystick1'){
		if (evt.deltaX == 0 && evt.deltaY == 0){
			var url ='motor.php?state=19';
			xhr.open('GET', url, false);
			xhr.send();
		}
		else if(evt.deltaX > -20 && evt.deltaX < 20 && evt.deltaY > 0 && evt.deltaY <= 60){
			var url ='motor.php?state=11';
			xhr.open('GET', url, false);
			xhr.send();
		}
		else if(evt.deltaX < -20 && evt.deltaX > -50 && evt.deltaY > 0 && evt.deltaY < 50 && evt.deltaY > 20){
			var url ='motor.php?state=12';
			xhr.open('GET', url, false);
			xhr.send();
		}
		else if(evt.deltaX >= -60 && evt.deltaX < 0 && evt.deltaY > -20 && evt.deltaY < 20){
			var url ='motor.php?state=13';
			xhr.open('GET', url, false);
			xhr.send();
		}
		else if(evt.deltaX < -20 && evt.deltaX > -50 && evt.deltaY < 0 && evt.deltaY < -20 && evt.deltaY > -50){
			var url ='motor.php?state=14';
			xhr.open('GET', url, false);
			xhr.send();
		}
		else if(evt.deltaX > -20 && evt.deltaX < 20 && evt.deltaY < 0 && evt.deltaY >= -60){
			var url ='motor.php?state=15';
			xhr.open('GET', url, false);
			xhr.send();
		}
		else if(evt.deltaX < 50 && evt.deltaX > 20 && evt.deltaY < 0 && evt.deltaY < -20 && evt.deltaY > -50){
			var url ='motor.php?state=16';
			xhr.open('GET', url, false);
			xhr.send();
		}
		else if(evt.deltaX > 0 && evt.deltaX <= 60 && evt.deltaY > -20 && evt.deltaY < 20){
			var url ='motor.php?state=17';
			xhr.open('GET', url, false);
			xhr.send();
		}
		else if(evt.deltaX < 50 && evt.deltaX > 20 && evt.deltaY > 0 && evt.deltaY < 50 && evt.deltaY > 20){
			var url ='motor.php?state=18';
			xhr.open('GET', url, false);
			xhr.send();
		}
		}
		else {
		if(evt.deltaY > 0 && evt.deltaY <= 60) {
			var url ='motor.php?state=6';
			xhr.open('GET', url, false);
			xhr.send();
		}
		else if(evt.deltaY >= -60 && evt.deltaY < -0) {
			var url ='motor.php?state=7';
			xhr.open('GET', url, false);
			xhr.send();
		}
		else if (evt.deltaY == 0) {
			var url ='motor.php?state=8';
			xhr.open('GET', url, false);
			xhr.send();
		}
		}
    	}
	
  </script>

</html>
